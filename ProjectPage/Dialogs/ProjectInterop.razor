@page "/project-account-ui"
@using System.Numerics
@using MudBlazor
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject IStringLocalizer<ProjectInterop> L


<MudContainer MaxWidth="MaxWidth.False" Class="pa-4">
    <MudPaper Elevation="3" Class="pa-4">
        <MudText Typo="Typo.h4">ProjectAccount — UI / UX Control Panel</MudText>
        <MudDivider Class="my-2" />

        <MudTabs Rounded="true">
            <MudTabPanel Text="Voting System">
                <MudGrid>
                    <MudItem xs="12" md="4">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Quick Vote</MudText>
                            <MudSelect T="string" Label="Vote Type" @bind-Value="quickVoteType">
                                <MudSelectItem Value="Launch">Launch</MudSelectItem>
                                <MudSelectItem Value="IncreaseBudget">Increase Budget</MudSelectItem>
                                <MudSelectItem Value="Closure">Successful Closure</MudSelectItem>
                                <MudSelectItem Value="Pause">Pause/Resume</MudSelectItem>
                                <MudSelectItem Value="Termination">Termination With Refund</MudSelectItem>
                            </MudSelect>

                            <MudTextField Label="Backer (Hex Address)" @bind-Value="quickBacker"/>

                            <MudRadioGroup T="string" @bind-SelectedOption="quickVoteChoice">
                                <MudRadio T="string" Value="For">For</MudRadio>
                                <MudRadio T="string" Value="Against">Against</MudRadio>
                                <MudRadio T="string" Value="Abstain">Abstain</MudRadio>
                            </MudRadioGroup>

                            <MudButton Variant="Variant.Filled" OnClick="(()=>InvokeStub())">Submit Vote</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="8">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Voting Operations</MudText>
                            <MudGrid>
                                <MudItem xs="12" md="6">
                                    <MudTextField Label="Voter Address" @bind-Value="addr1" />
                                    <MudTextField Label="Update Id / Hash" @bind-Value="updateId" />
                                    <MudButton OnClick="(()=>InvokeStub())">Vote Update</MudButton>
                                </MudItem>

                                <MudItem xs="12" md="6">
                                    <MudTextField Label="Manufacturer Address" @bind-Value="manufacturerAddr" />
                                    <MudNumericField T="int" Label="Step Number" @bind-Value="stepNumber" />
                                    <MudButton OnClick="(()=>InvokeStub())">Vote Milestone</MudButton>
                                </MudItem>

                                <MudItem xs="12">
                                    <MudExpansionPanels>
                                        <MudExpansionPanel Text="Vote Validation & Calculations">
                                            <MudGrid>
                                                <MudItem xs="12" md="4">
                                                    <MudNumericField T="long" Label="Positive Raw" @bind-Value="positiveRaw" />
                                                </MudItem>
                                                <MudItem xs="12" md="4">
                                                    <MudNumericField T="long" Label="Negative Raw" @bind-Value="negativeRaw" />
                                                </MudItem>
                                                <MudItem xs="12" md="4">
                                                    <MudNumericField T="long" Label="Abstained Raw" @bind-Value="abstainedRaw" />
                                                </MudItem>
                                                <MudItem xs="12">
                                                    <MudButton OnClick="(()=>InvokeStub())">Calculate Outcome</MudButton>
                                                </MudItem>
                                            </MudGrid>
                                        </MudExpansionPanel>
                                        <MudExpansionPanel Text="Voting Configuration">
                                            <MudGrid>
                                                <MudItem xs="12" md="6">
                                                    <MudNumericField T="decimal" Label="Min Participation %" @bind-Value="minParticipation" />
                                                </MudItem>
                                                <MudItem xs="12" md="6">
                                                    <MudNumericField T="decimal" Label="Min Approval %" @bind-Value="minApproval" />
                                                </MudItem>
                                                <MudItem xs="12" md="6">
                                                    <MudDatePicker Label="Voting Deadline" @bind-Date="votingDeadline" />
                                                </MudItem>
                                                <MudItem xs="12" md="6">
                                                    <MudButton OnClick="(()=>InvokeStub())">Update Voting Params</MudButton>
                                                </MudItem>
                                            </MudGrid>
                                        </MudExpansionPanel>
                                    </MudExpansionPanels>
                                </MudItem>
                            </MudGrid>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Milestones">
                <MudGrid>
                    <MudItem xs="12" md="4">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Create Milestone Request</MudText>
                            <MudTextField Label="Manufacturer" @bind-Value="mManufacturer" />
                            <MudNumericField T="int" Label="Step Number" @bind-Value="mStep" />
                            <MudTextField Label="Name" @bind-Value="mName" />
                            <MudTextField Label="Description" Lines="3" @bind-Value="mDesc" />
                            <MudNumericField T="decimal" Label="Requested Amount" @bind-Value="mAmount" />
                            <MudDatePicker Label="Deadline" @bind-Date="mDeadline" />
                            <MudNumericField T="int" Label="Voting Duration (days)" @bind-Value="mVotingDuration" />
                            <MudButton OnClick="(()=>InvokeStub())">Create Request</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="8">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Milestone List</MudText>
                            <MudTable Items="milestones" Dense="true">
                                <HeaderContent>
                                    <MudTh>Manufacturer</MudTh>
                                    <MudTh>Step</MudTh>
                                    <MudTh>Name</MudTh>
                                    <MudTh>Requested</MudTh>
                                    <MudTh>Deadline</MudTh>
                                    <MudTh>Actions</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd>@context.Manufacturer</MudTd>
                                    <MudTd>@context.Step</MudTd>
                                    <MudTd>@context.Name</MudTd>
                                    <MudTd>@context.Requested</MudTd>
                                    <MudTd>@context.Deadline.ToShortDateString()</MudTd>
                                    <MudTd>
                                        <MudButton Variant="Variant.Text" OnClick="(()=>InvokeStub())">Start Voting</MudButton>
                                        <MudButton Variant="Variant.Outlined" OnClick="(()=>InvokeStub())">Finalize</MudButton>
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </MudPaper>
                    </MudItem>
                </MudGrid>

                <MudDivider Class="my-2" />

                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Milestone Verification</MudText>
                            <MudTextField Label="Project Id" @bind-Value="verifyProjectId" />
                            <MudTextField Label="Manufacturer" @bind-Value="verifyManufacturer" />
                            <MudNumericField T="int" Label="Step" @bind-Value="verifyStep" />
                            <MudTextField T="string" Label="Proof (URL or Hash)" @bind-Value="verifyProof" />
                            <MudSwitch T="bool" Label="Is Verified" @bind-Checked="isVerified" />
                            <MudButton OnClick="(()=>InvokeStub())">Submit Verification</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Analytics</MudText>
                            <MudStack Spacing="2">
                                <MudChart ChartType="ChartType.Line" Height="150px" />
                                <MudText>Performance Map</MudText>
                                <MudTable Items="milestones" Dense="true">
                                    <HeaderContent>
                                        <MudTh>Milestone</MudTh>
                                        <MudTh>Progress %</MudTh>
                                    </HeaderContent>
                                    <RowTemplate>
                                        <MudTd>Step @context.Step</MudTd>
                                        <MudTd>@context.Progress</MudTd>
                                    </RowTemplate>
                                </MudTable>
                            </MudStack>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Manufacturers">
                <MudGrid>
                    <MudItem xs="12" md="4">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Register / Validate</MudText>
                            <MudTextField Label="Manufacturer Address" @bind-Value="regManufacturer" />
                            <MudTextField Label="Project Id" @bind-Value="regProjectId" />
                            <MudButton OnClick="(()=>InvokeStub())">Register Candidate</MudButton>
                            <MudButton OnClick="(()=>InvokeStub())">Validate Manufacturer</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="8">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Manufacturer Directory</MudText>
                            <MudTable Items="manufacturers" Hover="true" Dense="true">
                                <HeaderContent>
                                    <MudTh>Address</MudTh>
                                    <MudTh>Score</MudTh>
                                    <MudTh>Reliability</MudTh>
                                    <MudTh>Actions</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd>@context.Address</MudTd>
                                    <MudTd>@context.Score</MudTd>
                                    <MudTd>@context.Tier</MudTd>
                                    <MudTd>
                                        <MudIconButton Icon="Icons.Material.Filled.ThumbUp" OnClick="(()=>InvokeStub())" />
                                        <MudIconButton Icon="Icons.Material.Filled.Delete" Color="Color.Error" OnClick="(()=>InvokeStub())" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Investments & Funds">
                <MudGrid>
                    <MudItem xs="12" md="5">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Invest</MudText>
                            <MudTextField Label="Investor Address" @bind-Value="invAddress" />
                            <MudTextField Label="Manufacturer Address" @bind-Value="invManufacturer" />
                            <MudNumericField T="decimal" Label="Amount" @bind-Value="invAmount" />
                            <MudButton OnClick="(()=>InvokeStub())">Invest</MudButton>
                            <MudButton OnClick="(()=>InvokeStub())">Withdraw</MudButton>
                        </MudPaper>

                        <MudPaper Class="pa-3 mt-3">
                            <MudText Typo="Typo.h6">Funds Management</MudText>
                            <MudSlider Min="0" Max="100" @bind-Value="reservePercent" />
                            <MudText>Reserve Allocation: @reservePercent %</MudText>
                            <MudSwitch T="bool" Label="Lock Funds" @bind-Checked="lockFunds" />
                            <MudButton OnClick="(()=>InvokeStub())">Allocate</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="7">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Prize Fund & Distribution</MudText>
                            <MudTable Items="prizeFund" Dense="true">
                                <HeaderContent>
                                    <MudTh>Backer</MudTh>
                                    <MudTh>Amount</MudTh>
                                    <MudTh>Reserved</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd>@context.Backer</MudTd>
                                    <MudTd>@context.Amount</MudTd>
                                    <MudTd>@context.Reserved</MudTd>
                                </RowTemplate>
                            </MudTable>
                            <MudButton OnClick="(()=>InvokeStub())">Distribute Funds</MudButton>
                            <MudButton OnClick="(()=>InvokeStub())">Safe Refund All</MudButton>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Disputes & Penalties">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Open Dispute</MudText>
                            <MudTextField Label="Initiator" @bind-Value="disInitiator" />
                            <MudSelect T="string" Label="Dispute Type" @bind-Value="disType">
                                <MudSelectItem Value="Payment">Payment</MudSelectItem>
                                <MudSelectItem Value="Quality">Quality</MudSelectItem>
                                <MudSelectItem Value="Fraud">Fraud</MudSelectItem>
                            </MudSelect>
                            <MudTextField Label="Description" Lines="3" @bind-Value="disDescription" />
                            <MudButton OnClick="(()=>InvokeStub())">Create Dispute</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Penalties</MudText>
                            <MudTextField Label="Manufacturer" @bind-Value="penManufacturer" />
                            <MudNumericField T="decimal" Label="Penalty Amount" @bind-Value="penAmount" />
                            <MudButton OnClick="(()=>InvokeStub())">Impose Penalty</MudButton>
                            <MudButton OnClick="(()=>InvokeStub())">Clear Penalty</MudButton>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Fraud Detection">
                <MudPaper Class="pa-3">
                    <MudText Typo="Typo.h6">Fraud Analysis Toolkit</MudText>
                    <MudGrid>
                        <MudItem xs="12" md="4">
                            <MudTextField Label="Project Id" @bind-Value="fraudProjectId" />
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudTextField Label="Voter Address" @bind-Value="fraudVoter" />
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudNumericField T="int" Label="Time Window (s)" @bind-Value="fraudWindow" />
                        </MudItem>
                        <MudItem xs="12">
                            <MudButton OnClick="(()=>InvokeStub())">Run Detection Suite</MudButton>
                            <MudButton Variant="Variant.Outlined" OnClick="(()=>InvokeStub())">Apply Fraud Penalties</MudButton>
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudTabPanel>

            <MudTabPanel Text="Project Lifecycle & Settings">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Project Status</MudText>
                            <MudChipSet T="bool">
                                <MudChip Color="Color.Success">Open</MudChip>
                                <MudChip Color="Color.Info">Paused</MudChip>
                                <MudChip Color="Color.Warning">Under Review</MudChip>
                                <MudChip Color="Color.Secondary">Archived</MudChip>
                            </MudChipSet>
                            <MudButton OnClick="(()=>InvokeStub())">Archive Project</MudButton>
                            <MudButton OnClick="(()=>InvokeStub())">Resume Project</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Settings JSON</MudText>
                            <MudTextField Lines="8" Label="Project Settings JSON" @bind-Value="settingsJson" />
                            <MudButton OnClick="(()=>InvokeStub())">Save Settings</MudButton>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Rewards & Referrals">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Referral</MudText>
                            <MudTextField Label="Backer" @bind-Value="refBacker" />
                            <MudTextField Label="Referrer" @bind-Value="refReferrer" />
                            <MudButton OnClick="(()=>InvokeStub())">Register Referrer</MudButton>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-3">
                            <MudText Typo="Typo.h6">Token Rewards</MudText>
                            <MudTextField Label="Token Contract Address" @bind-Value="tokenContract" />
                            <MudNumericField T="decimal" Label="Token Amount" @bind-Value="tokenAmount" />
                            <MudButton OnClick="(()=>InvokeStub())">Distribute Tokens</MudButton>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <MudTabPanel Text="Analytics & Backers">
                <MudPaper Class="pa-3">
                    <MudText Typo="Typo.h6">Participation Analytics</MudText>
                    <MudGrid>
                        <MudItem xs="12" md="4">
                            <MudDatePicker Label="From" @bind-Date="analyticsFrom" />
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudDatePicker Label="To" @bind-Date="analyticsTo" />
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudButton OnClick="(()=>InvokeStub())">Get Trend</MudButton>
                        </MudItem>
                    </MudGrid>

                    <MudDivider Class="my-2" />

                    <MudTable Items="backers" Dense="true">
                        <HeaderContent>
                            <MudTh>Address</MudTh>
                            <MudTh>AutoConsent</MudTh>
                            <MudTh>Prize Donation</MudTh>
                            <MudTh>Actions</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd>@context.Address</MudTd>
                            <MudTd>@context.AutoConsent</MudTd>
                            <MudTd>@context.PrizeDonation</MudTd>
                            <MudTd>
                                <MudSwitch T="bool" @bind-Checked="context.AutoConsent" />
                                <MudButton OnClick="(()=>InvokeStub())">View Votes</MudButton>
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudPaper>
            </MudTabPanel>
        </MudTabs>
    </MudPaper>
</MudContainer>

@code {










    public string Abstain = "Abstain";
    public string Against = "Against";
    public string Closure = "Closure";
    public string For = "For";
    public string Fraud = "Fraud";
    public string IncreaseBudget = "IncreaseBudget";
    public string isVerified = "isVerified";
    public string Launch = "Launch";
    public string Pause = "Pause";
    public string Payment = "Payment";
    public string Quality = "Quality";
    public string Termination = "Termination";
    public string verifyManufacturer = "verifyManufacturer";
    public string verifyProjectId = "verifyProjectId";
    public string verifyProof = "verifyProof";
    public int verifyStep = 0;





    string quickVoteType;
    string quickBacker;
    string quickVoteChoice;

    string addr1;
    string updateId;
    string manufacturerAddr;
    int stepNumber;

    long positiveRaw;
    long negativeRaw;
    long abstainedRaw;

    decimal minParticipation;
    decimal minApproval;
    DateTime? votingDeadline;

    string mManufacturer;
    int mStep;
    string mName;
    string mDesc;
    decimal mAmount;
    DateTime? mDeadline;
    int mVotingDuration;

    List<MilestoneRow> milestones = new(){ new MilestoneRow(){ Manufacturer="0xAAA", Step=1, Name="Design", Requested=1000, Deadline=DateTime.Today.AddDays(30)} };

    string regManufacturer;
    string regProjectId;
    List<ManufacturerRow> manufacturers = new(){ new ManufacturerRow(){ Address="0xMAN1", Score=85, Tier=2 } };

    string invAddress;
    string invManufacturer;
    decimal invAmount;
    int reservePercent;
    bool lockFunds;
    List<PrizeRow> prizeFund = new(){ new PrizeRow(){ Backer="0xB1", Amount=50, Reserved=false } };

    string disInitiator;
    string disType;
    string disDescription;
    string penManufacturer;
    decimal penAmount;

    string fraudProjectId;
    string fraudVoter;
    int fraudWindow;

    string settingsJson;

    string refBacker;
    string refReferrer;
    string tokenContract;
    decimal tokenAmount;

    DateTime? analyticsFrom;
    DateTime? analyticsTo;

    List<BackerRow> backers = new(){ new BackerRow(){ Address="0xB1", AutoConsent=true, PrizeDonation=50 } };

    void InvokeStub(){ Snackbar.Add("Stub invoked", Severity.Info); }

    class MilestoneRow{ public string Manufacturer{get;set;} public int Step{get;set;} public string Name{get;set;} public decimal Requested{get;set;} public DateTime Deadline{get;set;} public int Progress{get;set;} = 20; }
    class ManufacturerRow{ public string Address{get;set;} public int Score{get;set;} public int Tier{get;set;} }
    class PrizeRow{ public string Backer{get;set;} public decimal Amount{get;set;} public bool Reserved{get;set;} }
    class BackerRow{ public string Address{get;set;} public bool AutoConsent{get;set;} public decimal PrizeDonation{get;set;} }
}
