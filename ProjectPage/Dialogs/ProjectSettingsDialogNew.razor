@inject IStringLocalizer<ProjectSettingsDialog> L
@using System.Net
@using System.Numerics
@using System.Text
@using InnFork.Application.Features.BaseActorModels.DTOs
@using InnFork.NeoN3
@using static InnFork.NeoN3.IF_SCModels

@inject ICurrentUserService _currentUserService

<MudForm @ref="_form" Class="pa-4">
    <MudPaper Elevation="2" Class="pa-4" Style="min-width: 1400px; max-width: 2000px;">
        <MudContainer MaxWidth="MaxWidth.False" Class="pa-0">
            <MudTabs Elevation="2" Rounded="true" Position="Position.Top" ApplyEffectsToContainer="true" PanelClass="pa-6" Color="Color.Primary">
                
                <!-- ОСНОВНЫЕ НАСТРОЙКИ -->
                <MudTabPanel Text="@L["Основные"]" Icon="@Icons.Material.Filled.Settings">
                    <MudGrid Spacing="6">
                        <MudItem xs="12" md="6">
                            <MudCard Elevation="4" Class="mb-4">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6" Color="Color.Primary">
                                            <MudIcon Icon="@Icons.Material.Filled.AccountTree" Class="mr-2" />
                                            @L["Тип проекта"]
                                        </MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudRadioGroup T="ProjectFundingType" @bind-SelectedOption="Settings.projectFundingType">
                                        <MudRadio T="ProjectFundingType" Option="ProjectFundingType.AllOrNothing" Color="Color.Error">
                                            <MudText>@L["Все или ничего"]</MudText>
                                            <MudText Typo="Typo.caption" Color="Color.Secondary">@L["Средства возвращаются если цель не достигнута"]</MudText>
                                        </MudRadio>
                                        <MudRadio T="ProjectFundingType" Option="ProjectFundingType.Flexible" Color="Color.Success">
                                            <MudText>@L["Гибкое финансирование"]</MudText>
                                            <MudText Typo="Typo.caption" Color="Color.Secondary">@L["Средства сохраняются независимо от цели"]</MudText>
                                        </MudRadio>
                                        <MudRadio T="ProjectFundingType" Option="ProjectFundingType.RewardsBased" Color="Color.Info">
                                            <MudText>@L["На основе вознаграждений"]</MudText>
                                            <MudText Typo="Typo.caption" Color="Color.Secondary">@L["Инвесторы получают продукты или услуги"]</MudText>
                                        </MudRadio>
                                        <MudRadio T="ProjectFundingType" Option="ProjectFundingType.Philanthropic" Color="Color.Warning">
                                            <MudText>@L["Благотворительный"]</MudText>
                                            <MudText Typo="Typo.caption" Color="Color.Secondary">@L["Без ожидания возврата средств"]</MudText>
                                        </MudRadio>
                                        <MudRadio T="ProjectFundingType" Option="ProjectFundingType.Equity" Color="Color.Tertiary">
                                            <MudText>@L["Долевое участие"]</MudText>
                                            <MudText Typo="Typo.caption" Color="Color.Secondary">@L["Инвесторы получают долю в компании"]</MudText>
                                        </MudRadio>
                                    </MudRadioGroup>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudCard Elevation="4" Class="mb-4">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6" Color="Color.Primary">
                                            <MudIcon Icon="@Icons.Material.Filled.Description" Class="mr-2" />
                                            @L["Описание проекта"]
                                        </MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudTextField @bind-Value="Settings.ProjectDescription_NeoFS_Address"
                                                  Label="@L["Адрес в NeoFS"]"
                                                  Variant="Variant.Outlined"
                                                  Lines="3"
                                                  Adornment="Adornment.Start"
                                                  AdornmentIcon="@Icons.Material.Filled.Storage"
                                                  HelperText="Укажите адрес описания проекта в файловой системе NeoFS" />
                                    
                                    <MudSlider @bind-Value="Settings.ProjectPriority"
                                               Min="1"
                                               Max="5"
                                               Step="1"
                                               Color="Color.Primary"
                                               Class="mt-4">
                                        <MudText Typo="Typo.body2">@L["Приоритет проекта"]: @Settings.ProjectPriority</MudText>
                                    </MudSlider>

                                    <MudCheckBox T="bool" @bind-Checked="Settings.DirectInnforkManagement"
                                                 Label="@L["Прямое управление через InnFork Gateway"]"
                                                 Color="Color.Info"
                                                 Class="mt-4" />
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>

                <!-- ГОЛОСОВАНИЕ И УПРАВЛЕНИЕ -->
                <MudTabPanel Text="@L["Голосование"]" Icon="@Icons.Material.Filled.HowToVote">
                    <MudExpansionPanels MultiExpansion="true" Elevation="2">
                        <MudExpansionPanel Text="@L["Основные параметры голосования"]" Icon="@Icons.Material.Filled.Poll" IsInitiallyExpanded="true">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" sm="4">
                                    <MudNumericField T="BigInteger"
                                                     @bind-Value="Settings.MinimumVotesRequired"
                                                     Label="@L["Минимальное количество голосов"]"
                                                     Variant="Variant.Filled"
                                                     Adornment="Adornment.Start"
                                                     AdornmentIcon="@Icons.Material.Filled.HowToVote"
                                                     HelperText="Минимальное число голосов для принятия решения" />
                                </MudItem>
                                <MudItem xs="12" sm="4">
                                    <MudNumericField T="BigInteger"
                                                     @bind-Value="Settings.MinRequiredVotingParticipation"
                                                     Label="@L["Минимальный % участия"]"
                                                     Variant="Variant.Filled"
                                                     Adornment="Adornment.End"
                                                     AdornmentText="%"
                                                     Min="1"
                                                     Max="100" />
                                </MudItem>
                                <MudItem xs="12" sm="4">
                                    <MudNumericField T="BigInteger"
                                                     @bind-Value="Settings.MinApprovalPercentage"
                                                     Label="@L["Минимальный % одобрения"]"
                                                     Variant="Variant.Filled"
                                                     Adornment="Adornment.End"
                                                     AdornmentText="%"
                                                     Min="1"
                                                     Max="100" />
                                </MudItem>
                            </MudGrid>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="@L["Автоматизация голосований"]" Icon="@Icons.Material.Filled.AutoMode">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudPaper Elevation="1" Class="pa-4">
                                        <MudSwitch T="bool" @bind-Checked="Settings.AutoSetVoicelessAsAbstrainVote"
                                                   Label="@L["Неголосующие = воздержавшиеся"]"
                                                   Color="Color.Primary"
                                                   ThumbIcon="@Icons.Material.Filled.VoiceOverOff" />
                                        <MudDivider Class="my-2" />
                                        <MudSwitch T="bool" @bind-Checked="Settings.EnableAutoAbstainVote"
                                                   Label="@L["Автоматическое воздержание"]"
                                                   Color="Color.Secondary"
                                                   ThumbIcon="@Icons.Material.Filled.PauseCircle" />
                                        <MudDivider Class="my-2" />
                                        <MudSwitch T="bool" @bind-Checked="Settings.AutoFinishExpiredVotings"
                                                   Label="@L["Автозавершение просроченных"]"
                                                   Color="Color.Success"
                                                   ThumbIcon="@Icons.Material.Filled.Timer" />
                                    </MudPaper>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudPaper Elevation="1" Class="pa-4">
                                        <MudSwitch T="bool" @bind-Checked="Settings.AutoDistributeConsentedFunds"
                                                   Label="@L["Автораспределение средств"]"
                                                   Color="Color.Info"
                                                   ThumbIcon="@Icons.Material.Filled.AccountBalance" />
                                        <MudDivider Class="my-2" />
                                        <MudSwitch T="bool" @bind-Checked="Settings.AutoPauseEnabled"
                                                   Label="@L["Автоматическая пауза"]"
                                                   Color="Color.Warning"
                                                   ThumbIcon="@Icons.Material.Filled.Pause" />
                                        <MudDivider Class="my-2" />
                                        <MudSwitch T="bool" @bind-Checked="Settings.EnableFraudDetection"
                                                   Label="@L["Обнаружение мошенничества"]"
                                                   Color="Color.Error"
                                                   ThumbIcon="@Icons.Material.Filled.Security" />
                                    </MudPaper>
                                </MudItem>
                            </MudGrid>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="@L["Делегирование голосов"]" Icon="@Icons.Material.Filled.GroupWork">
                            <MudAlert Severity="Severity.Info" Class="mb-4">@L["Настройки делегирования позволяют пользователям передавать свои голоса доверенным лицам"]</MudAlert>
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="4">
                                    <MudSwitch T="bool" @bind-Checked="Settings.AllowVoteDelegation"
                                               Label="@L["Разрешить делегирование"]"
                                               Color="Color.Primary" />
                                </MudItem>
                                <MudItem xs="12" md="4">
                                    <MudNumericField T="int"
                                                     @bind-Value="Settings.MaxDelegationChainLength"
                                                     Label="@L["Максимальная длина цепи"]"
                                                     Variant="Variant.Outlined"
                                                     Min="1"
                                                     Max="10"
                                                     Disabled="!Settings.AllowVoteDelegation" />
                                </MudItem>
                                <MudItem xs="12" md="4">
                                    <MudSwitch T="bool" @bind-Checked="Settings.AllowDelegationRevocation"
                                               Label="@L["Разрешить отзыв делегирования"]"
                                               Color="Color.Secondary"
                                               Disabled="!Settings.AllowVoteDelegation" />
                                </MudItem>
                            </MudGrid>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </MudTabPanel>

                <!-- ПРОИЗВОДИТЕЛИ И ЭТАПЫ -->
                <MudTabPanel Text="@L["Производители"]" Icon="@Icons.Material.Filled.Factory">
                    <MudStepper @ref="manufacturerStepper" Color="Color.Primary" Variant="Variant.Filled">
                        <MudStep Title="@L["Базовые настройки"]" Icon="@Icons.Material.Filled.Settings">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudSelect T="MilestoneFundingType"
                                               @bind-Value="Settings.DefaultFundingType"
                                               Label="@L["Тип финансирования этапов"]"
                                               Variant="Variant.Outlined"
                                               AnchorOrigin="Origin.BottomCenter">
                                        <MudSelectItem Value="MilestoneFundingType.Before">
                                            <div style="display: flex; align-items: center;">
                                                <MudIcon Icon="@Icons.Material.Filled.ArrowUpward" Class="mr-2" Color="Color.Success" />
                                                @L["До начала работ"]
                                            </div>
                                        </MudSelectItem>
                                        <MudSelectItem Value="MilestoneFundingType.After">
                                            <div style="display: flex; align-items: center;">
                                                <MudIcon Icon="@Icons.Material.Filled.ArrowDownward" Class="mr-2" Color="Color.Warning" />
                                                @L["После выполнения"]
                                            </div>
                                        </MudSelectItem>
                                        <MudSelectItem Value="MilestoneFundingType.Split">
                                            <div style="display: flex; align-items: center;">
                                                <MudIcon Icon="@Icons.Material.Filled.CallSplit" Class="mr-2" Color="Color.Info" />
                                                @L["Раздельное финансирование"]
                                            </div>
                                        </MudSelectItem>
                                    </MudSelect>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudChipSet T="bool" @bind-SelectedChip="selectedManufacturerChip" MultiSelection="false" Filter="true">
                                        <MudChip Color="Color.Success" Icon="@Icons.Material.Filled.CheckCircle" 
                                                 Selected="Settings.AllowSteppedFinancing">@L["Поэтапное финансирование"]</MudChip>
                                        <MudChip Color="Color.Info" Icon="@Icons.Material.Filled.Timeline"
                                                 Selected="Settings.UseStandardMilestoneTemplates">@L["Стандартные шаблоны"]</MudChip>
                                        <MudChip Color="Color.Warning" Icon="@Icons.Material.Filled.Edit"
                                                 Selected="Settings.AllowCustomMilestoneTemplates">@L["Пользовательские шаблоны"]</MudChip>
                                    </MudChipSet>
                                </MudItem>
                            </MudGrid>
                        </MudStep>

                        <MudStep Title="@L["Ограничения"]" Icon="@Icons.Material.Filled.Policy">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="3">
                                    <MudBadge Content="@Settings.MaxManufacturers.ToString()" Color="Color.Primary" Overlap="true" Class="d-flex">
                                        <MudNumericField T="int"
                                                         @bind-Value="Settings.MaxManufacturers"
                                                         Label="@L["Макс. производителей"]"
                                                         Variant="Variant.Outlined"
                                                         Min="1"
                                                         Max="50"
                                                         Adornment="Adornment.Start"
                                                         AdornmentIcon="@Icons.Material.Filled.Group" />
                                    </MudBadge>
                                </MudItem>
                                <MudItem xs="12" md="3">
                                    <MudNumericField T="byte"
                                                     @bind-Value="Settings.MaxMilestoneSteps"
                                                     Label="@L["Макс. этапов"]"
                                                     Variant="Variant.Outlined"
                                                     Min="1"
                                                     Max="20"
                                                     Adornment="Adornment.Start"
                                                     AdornmentIcon="@Icons.Material.Filled.Timeline" />
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudNumericField T="BigInteger"
                                                     @bind-Value="Settings.MinManufacturerInvestment"
                                                     Label="@L["Минимальная инвестиция"]"
                                                     Variant="Variant.Outlined"
                                                     Adornment="Adornment.Start"
                                                     AdornmentText="$"
                                                     Format="N0" />
                                </MudItem>
                            </MudGrid>
                        </MudStep>

                        <MudStep Title="@L["Временные параметры"]" Icon="@Icons.Material.Filled.Schedule">
                            <MudTimeline TimelineOrientation="TimelineOrientation.Vertical" TimelinePosition="TimelinePosition.Alternate">
                                <MudTimelineItem Color="Color.Success" Icon="@Icons.Material.Filled.Timer">
                                    <MudNumericField T="ulong"
                                                     @bind-Value="Settings.DefaultVotingDuration"
                                                     Label="@L["Стандартная длительность голосования (часы)"]"
                                                     Variant="Variant.Filled"
                                                     Adornment="Adornment.End"
                                                     AdornmentText="ч" />
                                </MudTimelineItem>
                                <MudTimelineItem Color="Color.Info" Icon="@Icons.Material.Filled.Schedule">
                                    <MudDatePicker @bind-Value="Settings.PlannedCompletionDate"
                                                   Label="@L["Планируемая дата завершения"]"
                                                   Variant="Variant.Filled" />
                                </MudTimelineItem>
                                <MudTimelineItem Color="Color.Warning" Icon="@Icons.Material.Filled.AutoFixHigh">
                                    <MudSwitch T="bool" @bind-Checked="Settings.EnableAutomaticScheduling"
                                               Label="@L["Автоматическое планирование"]"
                                               Color="Color.Primary" />
                                </MudTimelineItem>
                            </MudTimeline>
                        </MudStep>
                    </MudStepper>
                </MudTabPanel>

                <!-- ФИНАНСОВЫЕ НАСТРОЙКИ -->
                <MudTabPanel Text="@L["Финансы"]" Icon="@Icons.Material.Filled.AttachMoney">
                    <MudTabs Elevation="1" Rounded="true" Position="Position.Left" PanelClass="pa-4">
                        <MudTabPanel Text="@L["Основные"]" Icon="@Icons.Material.Filled.AccountBalance">
                            <MudGrid Spacing="4" Class="align-stretch">
                                <MudItem xs="12" md="4" Class="d-flex">
                                    <MudCard Elevation="3" Class="pa-4 flex-grow-1" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 200px;">
                                        <MudCardContent Class="text-center d-flex flex-column justify-center" Style="height: 100%;">
                                            <MudIcon Icon="@Icons.Material.Filled.Percent" Color="Color.Surface" Size="Size.Large" />
                                            <MudText Typo="Typo.h6" Color="Color.Surface" Class="mt-2">@L["Комиссия создателя"]</MudText>
                                            <MudNumericField T="BigInteger"
                                                             @bind-Value="Settings.CreatorFeePercentage"
                                                             Variant="Variant.Outlined"
                                                             Adornment="Adornment.End"
                                                             AdornmentText="%"
                                                             Min="0"
                                                             Max="10"
                                                             Class="mt-2"
                                                             Style="background-color: rgba(255,255,255,0.9);" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="4" Class="d-flex">
                                    <MudCard Elevation="3" Class="pa-4 flex-grow-1" Style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); min-height: 200px;">
                                        <MudCardContent Class="text-center d-flex flex-column justify-center" Style="height: 100%;">
                                            <MudIcon Icon="@Icons.Material.Filled.StarRate" Color="Color.Surface" Size="Size.Large" />
                                            <MudText Typo="Typo.h6" Color="Color.Surface" Class="mt-2">@L["Фиксированная награда"]</MudText>
                                            <MudNumericField T="BigInteger"
                                                             @bind-Value="Settings.CreatorFixedReward"
                                                             Variant="Variant.Outlined"
                                                             Adornment="Adornment.Start"
                                                             AdornmentText="$"
                                                             Min="0"
                                                             Format="N0"
                                                             Class="mt-2"
                                                             Style="background-color: rgba(255,255,255,0.9);" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="4" Class="d-flex">
                                    <MudCard Elevation="3" Class="pa-4 flex-grow-1" Style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); min-height: 200px;">
                                        <MudCardContent Class="text-center d-flex flex-column justify-center" Style="height: 100%;">
                                            <MudIcon Icon="@Icons.Material.Filled.EmojiEvents" Color="Color.Surface" Size="Size.Large" />
                                            <MudText Typo="Typo.h6" Color="Color.Surface" Class="mt-2">@L["Призовой фонд"]</MudText>
                                            <MudNumericField T="BigInteger"
                                                             @bind-Value="Settings.FLM_PrizeFundGoal"
                                                             Variant="Variant.Outlined"
                                                             Adornment="Adornment.Start"
                                                             AdornmentText="$"
                                                             Min="0"
                                                             Format="N0"
                                                             Class="mt-2"
                                                             Style="background-color: rgba(255,255,255,0.9);" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>

                            <MudDivider Class="my-6" />

                            <MudGrid Spacing="4" Class="align-stretch">
                                <MudItem xs="12" md="6" Class="d-flex">
                                    <MudPaper Elevation="2" Class="pa-4 flex-grow-1" Style="min-height: 150px;">
                                        <MudText Typo="Typo.h6" Class="mb-4">@L["Автоматическая пауза"]</MudText>
                                        <MudSlider @bind-Value="Settings.AutoPauseLockThresholdPercent"
                                                   Min="0"
                                                   Max="100"
                                                   Step="5"
                                                   Color="Color.Warning"
                                                   ValueLabelFormat="{0}%">
                                            @L["Порог блокировки"]: @Settings.AutoPauseLockThresholdPercent%
                                        </MudSlider>
                                    </MudPaper>
                                </MudItem>
                                <MudItem xs="12" md="6" Class="d-flex">
                                    <MudPaper Elevation="2" Class="pa-4 flex-grow-1" Style="min-height: 150px;">
                                        <MudText Typo="Typo.h6" Class="mb-4">@L["Призовой фонд"]</MudText>
                                        <MudSlider T="byte" @bind-Value="Settings.DefaultPrizeFundAllocation"
                                                   Min="0"
                                                   Max="100"
                                                   Step="1"
                                                   Color="Color.Success"
                                                   ValueLabelFormat="{0}%">
                                            @L["Доля средств"]: @Settings.DefaultPrizeFundAllocation%
                                        </MudSlider>
                                    </MudPaper>
                                </MudItem>
                            </MudGrid>
                        </MudTabPanel>

                        <MudTabPanel Text="@L["Валюты"]" Icon="@Icons.Material.Filled.CurrencyExchange">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="2">
                                        <MudCardHeader>
                                            <CardHeaderContent>
                                                <MudText Typo="Typo.h6">@L["Основная валюта"]</MudText>
                                            </CardHeaderContent>
                                            <CardHeaderActions>
                                                <MudToggleIconButton @bind-Toggled="Settings.EnableMultiCurrency"
                                                                     Icon="@Icons.Material.Filled.CurrencyExchange"
                                                                     ToggledIcon="@Icons.Material.Filled.MonetizationOn"
                                                                     Color="Color.Primary" />
                                            </CardHeaderActions>
                                        </MudCardHeader>
                                        <MudCardContent>
                                            <MudSelect T="string"
                                                       @bind-Value="Settings.DefaultCurrency"
                                                       Label="@L["Валюта по умолчанию"]"
                                                       Variant="Variant.Outlined">
                                                <MudSelectItem Value="@("USD")">🇺🇸 USD - Доллар США</MudSelectItem>
                                                <MudSelectItem Value="@("EUR")">🇪🇺 EUR - Евро</MudSelectItem>
                                                <MudSelectItem Value="@("CNY")">🇨🇳 CNY - Китайский юань</MudSelectItem>
                                                <MudSelectItem Value="@("NEO")">🔗 NEO - Neo Token</MudSelectItem>
                                                <MudSelectItem Value="@("GAS")">⛽ GAS - Neo Gas</MudSelectItem>
                                            </MudSelect>
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="2">
                                        <MudCardHeader>
                                            <CardHeaderContent>
                                                <MudText Typo="Typo.h6">@L["Обменные курсы"]</MudText>
                                            </CardHeaderContent>
                                        </MudCardHeader>
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableDynamicExchangeRates"
                                                       Label="@L["Динамические курсы"]"
                                                       Color="Color.Primary"
                                                       Class="mb-3" />
                                            <MudTextField @bind-Value="Settings.ExchangeRateProvider"
                                                          Label="@L["Провайдер курсов"]"
                                                          Disabled="!Settings.EnableDynamicExchangeRates"
                                                          Variant="Variant.Outlined"
                                                          Class="mb-3" />
                                            <MudNumericField T="BigInteger"
                                                             @bind-Value="Settings.ExchangeRateSlippageTolerance"
                                                             Label="@L["Допустимое отклонение (%)"]"
                                                             Disabled="!Settings.EnableDynamicExchangeRates"
                                                             Variant="Variant.Outlined"
                                                             Min="0"
                                                             Max="20" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>
                        </MudTabPanel>

                        <MudTabPanel Text="@L["Ограничения"]" Icon="@Icons.Material.Filled.Policy">
                            <MudAlert Severity="Severity.Warning" Class="mb-4">
                                @L["Финансовые ограничения помогают предотвратить злоупотребления и соблюдать регулятивные требования"]
                            </MudAlert>
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudNumericField T="BigInteger"
                                                     @bind-Value="Settings.MaxInvestmentPerUser"
                                                     Label="@L["Максимальная инвестиция на пользователя"]"
                                                     Variant="Variant.Outlined"
                                                     Adornment="Adornment.Start"
                                                     AdornmentText="$"
                                                     HelperText="0 = без ограничений"
                                                     Format="N0" />
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudNumericField T="BigInteger"
                                                     @bind-Value="Settings.MinReferralInvestment"
                                                     Label="@L["Минимальная реферальная инвестиция"]"
                                                     Variant="Variant.Outlined"
                                                     Adornment="Adornment.Start"
                                                     AdornmentText="$"
                                                     Format="N0" />
                                </MudItem>
                                <MudItem xs="12">
                                    <MudSwitch T="bool" @bind-Checked="Settings.RequireKYCVerification"
                                               Label="@L["Требовать KYC верификацию"]"
                                               Color="Color.Warning"
                                               ThumbIcon="@Icons.Material.Filled.VerifiedUser" />
                                </MudItem>
                            </MudGrid>
                        </MudTabPanel>
                    </MudTabs>
                </MudTabPanel>

                <!-- ВРЕМЕННЫЕ НАСТРОЙКИ -->
                <MudTabPanel Text="@L["Сроки"]" Icon="@Icons.Material.Filled.DateRange">
                    <MudGrid Spacing="4">
                        <MudItem xs="12" lg="8">
                            <MudCard Elevation="3">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6" Color="Color.Primary">@L["Основные дедлайны"]</MudText>
                                    </CardHeaderContent>
                                    <CardHeaderActions>
                                        <MudIconButton Icon="@Icons.Material.Filled.Today" Color="Color.Primary" />
                                    </CardHeaderActions>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudSimpleTable Style="overflow-x: auto;" Hover="true" Striped="true">
                                        <thead>
                                            <tr>
                                                <th>@L["Этап"]</th>
                                                <th>@L["Дата"]</th>
                                                <th>@L["Статус"]</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <MudIcon Icon="@Icons.Material.Filled.MonetizationOn" Color="Color.Success" Class="mr-2" />
                                                    @L["Сбор средств"]
                                                </td>
                                                <td>
                                                    <MudDatePicker @bind-Value="Settings.FundraisingDeadline"
                                                                   Variant="Variant.Text"
                                                                   ShowToolbar="false" />
                                                </td>
                                                <td>
                                                    <MudChip T="bool" Size="Size.Small" Color="Color.Success">@L["Активен"]</MudChip>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <MudIcon Icon="@Icons.Material.Filled.Groups" Color="Color.Info" Class="mr-2" />
                                                    @L["Выбор производителя"]
                                                </td>
                                                <td>
                                                    <MudDatePicker @bind-Value="Settings.ManufacturerSelectionDeadline"
                                                                   Variant="Variant.Text"
                                                                   ShowToolbar="false" />
                                                </td>
                                                <td>
                                                    <MudChip T="bool" Size="Size.Small" Color="Color.Warning">@L["Ожидание"]</MudChip>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <MudIcon Icon="@Icons.Material.Filled.RocketLaunch" Color="Color.Primary" Class="mr-2" />
                                                    @L["Запуск проекта"]
                                                </td>
                                                <td>
                                                    <MudDatePicker @bind-Value="Settings.LaunchVotingDeadline"
                                                                   Variant="Variant.Text"
                                                                   ShowToolbar="false" />
                                                </td>
                                                <td>
                                                    <MudChip T="bool" Size="Size.Small" Color="Color.Secondary">@L["Запланирован"]</MudChip>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </MudSimpleTable>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>

                        <MudItem xs="12" lg="4">
                            <MudCard Elevation="3">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6" Color="Color.Primary">@L["Часовой пояс"]</MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudAutocomplete T="string"
                                                     @bind-Value="Settings.DefaultTimezone"
                                                     SearchFunc="SearchTimezones"
                                                     Label="@L["Выберите часовой пояс"]"
                                                     Variant="Variant.Outlined"
                                                     AdornmentIcon="@Icons.Material.Filled.Schedule"
                                                     Adornment="Adornment.Start" />
                                    
                                    <MudSelect T="string"
                                               @bind-Value="Settings.DefaultLanguage"
                                               Label="@L["Язык по умолчанию"]"
                                               Variant="Variant.Outlined"
                                               Class="mt-4">
                                        <MudSelectItem Value="@("ru")">🇷🇺 Русский</MudSelectItem>
                                        <MudSelectItem Value="@("en")">🇺🇸 English</MudSelectItem>
                                        <MudSelectItem Value="@("zh")">🇨🇳 中文</MudSelectItem>
                                        <MudSelectItem Value="@("es")">🇪🇸 Español</MudSelectItem>
                                    </MudSelect>
                                </MudCardContent>
                            </MudCard>

                            <MudCard Elevation="3" Class="mt-4">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6" Color="Color.Warning">@L["Тайм-ауты"]</MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudNumericField T="BigInteger"
                                                 @bind-Value="Settings.WithdrawalTimeout"
                                                 Label="@L["Вывод средств (дни)"]"
                                                 Variant="Variant.Outlined"
                                                 Adornment="Adornment.End"
                                                 AdornmentText="дн" />
                            </MudCard>
                        </MudItem>
                    </MudGrid>
                </MudTabPanel>

                <!-- БЕЗОПАСНОСТЬ И СООТВЕТСТВИЕ -->
                <MudTabPanel Text="@L["Безопасность"]" Icon="@Icons.Material.Filled.Security">
                    <MudTabs Elevation="1" Rounded="true" Position="Position.Top" PanelClass="pa-4">
                        <MudTabPanel Text="@L["Мошенничество"]" Icon="@Icons.Material.Filled.GppBad">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="2" Class="pa-4">
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableAdvancedFraudDetection"
                                                       Label="@L["Расширенное обнаружение мошенничества"]"
                                                       Color="Color.Error"
                                                       ThumbIcon="@Icons.Material.Filled.Shield" />
                                            
                                            <MudSlider @bind-Value="Settings.FraudDetectionSensitivity"
                                                       Min="1"
                                                       Max="100"
                                                       Step="5"
                                                       Color="Color.Error"
                                                       Class="mt-4"
                                                       Disabled="!Settings.EnableAdvancedFraudDetection">
                                                @L["Чувствительность"]: @Settings.FraudDetectionSensitivity%
                                            </MudSlider>

                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableBehaviorAnalysis"
                                                       Label="@L["Анализ поведения пользователей"]"
                                                       Color="Color.Warning"
                                                       Class="mt-4"
                                                       Disabled="!Settings.EnableAdvancedFraudDetection" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="2" Class="pa-4">
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.RequireTwoFactorAuth"
                                                       Label="@L["Двухфакторная аутентификация"]"
                                                       Color="Color.Success"
                                                       ThumbIcon="@Icons.Material.Filled.LockPerson" />
                                            
                                            <MudAlert Severity="Severity.Info" Class="mt-4">
                                                @L["2FA значительно повышает безопасность учетных записей пользователей"]
                                            </MudAlert>
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>
                        </MudTabPanel>

                        <MudTabPanel Text="@L["Экстренные ситуации"]" Icon="@Icons.Material.Filled.Emergency">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="8">
                                    <MudCard Elevation="2">
                                        <MudCardHeader>
                                            <CardHeaderContent>
                                                <MudText Typo="Typo.h6" Color="Color.Error">@L["Экстренная пауза"]</MudText>
                                            </CardHeaderContent>
                                        </MudCardHeader>
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableEmergencyPause"
                                                       Label="@L["Разрешить экстренную паузу"]"
                                                       Color="Color.Error"
                                                       Class="mb-4" />
                                            
                                            <MudNumericField T="BigInteger"
                                                             @bind-Value="Settings.EmergencyRefundThreshold"
                                                             Label="@L["Порог экстренного возврата (%)"]"
                                                             Variant="Variant.Outlined"
                                                             Disabled="!Settings.EnableEmergencyPause"
                                                             Min="50"
                                                             Max="100"
                                                             Adornment="Adornment.End"
                                                             AdornmentText="%" />
                                            
                                            <MudSwitch T="bool" @bind-Checked="Settings.AutoActivateEmergencyMode"
                                                       Label="@L["Автоактивация экстренного режима"]"
                                                       Color="Color.Warning"
                                                       Disabled="!Settings.EnableEmergencyPause"
                                                       Class="mt-4" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="4">
                                    <MudCard Elevation="2" Style="height: 100%;">
                                        <MudCardHeader>
                                            <CardHeaderContent>
                                                <MudText Typo="Typo.h6" Color="Color.Info">@L["Откат изменений"]</MudText>
                                            </CardHeaderContent>
                                        </MudCardHeader>
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableMilestoneRollback"
                                                       Label="@L["Разрешить откат этапов"]"
                                                       Color="Color.Info"
                                                       Class="mb-3" />
                                            
                                            <MudNumericField T="ulong"
                                                             @bind-Value="Settings.MaxRollbackWindow"
                                                             Label="@L["Окно отката (дни)"]"
                                                             Variant="Variant.Outlined"
                                                             Disabled="!Settings.EnableMilestoneRollback"
                                                             Min="1"
                                                             Max="90"
                                                             Adornment="Adornment.End"
                                                             AdornmentText="дн" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>
                        </MudTabPanel>

                        <MudTabPanel Text="@L["Соответствие"]" Icon="@Icons.Material.Filled.Gavel">
                            <MudAlert Severity="Severity.Warning" Class="mb-4">
                                @L["Настройки соответствия регулятивным требованиям могут быть обязательными в некоторых юрисдикциях"]
                            </MudAlert>
                            
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="2">
                                        <MudCardHeader>
                                            <CardHeaderContent>
                                                <MudText Typo="Typo.h6">@L["Режим соответствия"]</MudText>
                                            </CardHeaderContent>
                                        </MudCardHeader>
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableComplianceMode"
                                                       Label="@L["Включить режим соответствия"]"
                                                       Color="Color.Warning"
                                                       Class="mb-3" />
                                            
                                            <MudSwitch T="bool" @bind-Checked="Settings.RequireAMLCompliance"
                                                       Label="@L["Требовать AML соответствие"]"
                                                       Color="Color.Error"
                                                       Disabled="!Settings.EnableComplianceMode" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="2">
                                        <MudCardHeader>
                                            <CardHeaderContent>
                                                <MudText Typo="Typo.h6">@L["Географические ограничения"]</MudText>
                                            </CardHeaderContent>
                                        </MudCardHeader>
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableGeographicRestrictions"
                                                       Label="@L["Включить географические ограничения"]"
                                                       Color="Color.Info"
                                                       Class="mb-3" />
                                            
                                            <MudText Typo="Typo.caption" Class="mb-2">@L["Разрешенные страны"]:</MudText>
                                            <MudChipSet T="bool" MultiSelection="true" Disabled="!Settings.EnableGeographicRestrictions">
                                                <MudChip Icon="@Icons.Material.Filled.Flag">🇷🇺 Россия</MudChip>
                                                <MudChip Icon="@Icons.Material.Filled.Flag">🇺🇸 США</MudChip>
                                                <MudChip Icon="@Icons.Material.Filled.Flag">🇪🇺 ЕС</MudChip>
                                                <MudChip Icon="@Icons.Material.Filled.Flag">🇨🇳 Китай</MudChip>
                                            </MudChipSet>
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>
                        </MudTabPanel>
                    </MudTabs>
                </MudTabPanel>

                <!-- ДОПОЛНИТЕЛЬНЫЕ ФУНКЦИИ -->
                <MudTabPanel Text="@L["Дополнительно"]" Icon="@Icons.Material.Filled.Extension">
                    <MudExpansionPanels MultiExpansion="true" Elevation="2">
                        <MudExpansionPanel Text="@L["Реферальная система"]" Icon="@Icons.Material.Filled.Share">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudSwitch T="bool" @bind-Checked="Settings.EnableReferralSystem"
                                               Label="@L["Включить реферальную систему"]"
                                               Color="Color.Primary"
                                               ThumbIcon="@Icons.Material.Filled.PersonAdd" />
                                </MudItem>
                                <MudItem xs="12" md="3">
                                    <MudNumericField T="BigInteger"
                                                     @bind-Value="Settings.ReferralRewardPercentage"
                                                     Label="@L["Процент вознаграждения"]"
                                                     Variant="Variant.Outlined"
                                                     Disabled="!Settings.EnableReferralSystem"
                                                     Min="0"
                                                     Max="10"
                                                     Adornment="Adornment.End"
                                                     AdornmentText="%" />
                                </MudItem>
                                <MudItem xs="12" md="3">
                                    <MudNumericField T="int"
                                                     @bind-Value="Settings.MaxReferralLevels"
                                                     Label="@L["Максимальный уровень"]"
                                                     Variant="Variant.Outlined"
                                                     Disabled="!Settings.EnableReferralSystem"
                                                     Min="1"
                                                     Max="5" />
                                </MudItem>
                            </MudGrid>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="@L["Уведомления"]" Icon="@Icons.Material.Filled.Notifications">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="4">
                                    <MudPaper Elevation="1" Class="pa-4">
                                        <MudSwitch T="bool" @bind-Checked="Settings.EnableNotifications"
                                                   Label="@L["Включить уведомления"]"
                                                   Color="Color.Primary" />
                                        <MudSwitch T="bool" @bind-Checked="Settings.EnableEmailNotifications"
                                                   Label="@L["Email уведомления"]"
                                                   Color="Color.Secondary"
                                                   Disabled="!Settings.EnableNotifications"
                                                   Class="mt-2" />
                                    </MudPaper>
                                </MudItem>
                                <MudItem xs="12" md="4">
                                    <MudPaper Elevation="1" Class="pa-4">
                                        <MudSwitch T="bool"  @bind-Checked="Settings.SendVotingReminders"
                                                   Label="@L["Напоминания о голосовании"]"
                                                   Color="Color.Info"
                                                   Disabled="!Settings.EnableNotifications" />
                                        <MudSwitch T="bool" @bind-Checked="Settings.SendMilestoneAlerts"
                                                   Label="@L["Уведомления об этапах"]"
                                                   Color="Color.Warning"
                                                   Disabled="!Settings.EnableNotifications"
                                                   Class="mt-2" />
                                    </MudPaper>
                                </MudItem>
                                <MudItem xs="12" md="4">
                                    <MudNumericField T="ulong"
                                                     @bind-Value="Settings.VotingReminderInterval"
                                                     Label="@L["Интервал напоминаний (часы)"]"
                                                     Variant="Variant.Outlined"
                                                     Disabled="!Settings.SendVotingReminders"
                                                     Min="1"
                                                     Max="168"
                                                     Adornment="Adornment.End"
                                                     AdornmentText="ч" />
                                </MudItem>
                            </MudGrid>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="@L["Аналитика и отчеты"]" Icon="@Icons.Material.Filled.Analytics">
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="1">
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.EnableDetailedAnalytics"
                                                       Label="@L["Подробная аналитика"]"
                                                       Color="Color.Primary"
                                                       Class="mb-3" />
                                            <MudSwitch T="bool" @bind-Checked="Settings.GeneratePerformanceReports"
                                                       Label="@L["Отчеты о производительности"]"
                                                       Color="Color.Secondary"
                                                       Disabled="!Settings.EnableDetailedAnalytics" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudCard Elevation="1">
                                        <MudCardContent>
                                            <MudSwitch T="bool" @bind-Checked="Settings.ExportDataEnabled"
                                                       Label="@L["Экспорт данных"]"
                                                       Color="Color.Info"
                                                       Class="mb-3" />
                                            <MudNumericField T="ulong"
                                                             @bind-Value="Settings.AnalyticsRetentionPeriod"
                                                             Label="@L["Период хранения (дни)"]"
                                                             Variant="Variant.Outlined"
                                                             Disabled="!Settings.EnableDetailedAnalytics"
                                                             Min="30"
                                                             Max="3650"
                                                             Adornment="Adornment.End"
                                                             AdornmentText="дн" />
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>
                        </MudExpansionPanel>

                        <MudExpansionPanel Text="@L["Тестирование и разработка"]" Icon="@Icons.Material.Filled.BugReport">
                            <MudAlert Severity="Severity.Warning" Class="mb-4">
                                @L["Эти настройки предназначены только для разработки и тестирования"]
                            </MudAlert>
                            <MudGrid Spacing="4">
                                <MudItem xs="12" md="4">
                                    <MudSwitch T="bool" @bind-Checked="Settings.IsTestMode"
                                               Label="@L["Тестовый режим"]"
                                               Color="Color.Warning"
                                               ThumbIcon="@Icons.Material.Filled.TextSnippet" />
                                </MudItem>
                                <MudItem xs="12" md="4">
                                    <MudSwitch T="bool" @bind-Checked="Settings.EnableDebugLogging"
                                               Label="@L["Отладочное логирование"]"
                                               Color="Color.Info"
                                               ThumbIcon="@Icons.Material.Filled.Code" />
                                </MudItem>
                                <MudItem xs="12" md="4">
                                    <MudSwitch T="bool" @bind-Checked="Settings.AllowBetaFeatures"
                                               Label="@L["Бета-функции"]"
                                               Color="Color.Secondary"
                                               ThumbIcon="@Icons.Material.Filled.NewReleases" />
                                </MudItem>
                                <MudItem xs="12">
                                    <MudTextField @bind-Value="Settings.TestNetworkEndpoint"
                                                  Label="@L["Тестовая сеть"]"
                                                  Variant="Variant.Outlined"
                                                  Disabled="!Settings.IsTestMode"
                                                  HelperText="URL тестовой сети для разработки" />
                                </MudItem>
                            </MudGrid>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </MudTabPanel>
            </MudTabs>

            <!-- ПАНЕЛЬ ДЕЙСТВИЙ -->
            <MudDivider Class="my-6" />
            <MudPaper Elevation="1" Class="pa-4">
                <MudStack Row="true" Spacing="3" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <MudStack Row="true" Spacing="2">
                        <MudButton OnClick="Reset"
                                   Color="Color.Secondary"
                                   Variant="Variant.Outlined"
                                   StartIcon="@Icons.Material.Filled.RestartAlt"
                                   Size="Size.Large">
                            @L["Сброс"]
                        </MudButton>
                        
                        <MudButton OnClick="Save"
                                   Color="Color.Info"
                                   Variant="Variant.Filled"
                                   StartIcon="@Icons.Material.Filled.Save"
                                   Size="Size.Large">
                            @L["Сохранить"]
                        </MudButton>
                    </MudStack>

                    <MudProgressCircular Color="Color.Primary" Size="Size.Small" Indeterminate="true" Style="visibility: hidden;" />

                    <MudStack Row="true" Spacing="2">
                        <MudButton OnClick="@(() => MudDialog.Cancel())"
                                   Color="Color.Default"
                                   Variant="Variant.Text"
                                   StartIcon="@Icons.Material.Filled.Cancel"
                                   Size="Size.Large">
                            @L["Отмена"]
                        </MudButton>
                        
                        <MudButton OnClick="Ok"
                                   Color="Color.Success"
                                   Variant="Variant.Filled"
                                   StartIcon="@Icons.Material.Filled.CheckCircle"
                                   Size="Size.Large">
                            @L["Применить"]
                        </MudButton>
                    </MudStack>
                </MudStack>
            </MudPaper>
        </MudContainer>
    </MudPaper>
</MudForm>


@code
{
    [Parameter] public ProjectSettings Settings { get; set; } = new();

    private MudForm _form;
    private MudStepper manufacturerStepper;
    private MudChip<bool> selectedManufacturerChip;

    private async Task Save()
    {
        await _form.Validate();

        if (_form.IsValid)
        {
            // Логика сохранения
        }
    }

    [CascadingParameter] IMudDialogInstance MudDialog { get; set; }

    BaseActorModelDto BaseActor = new();

    [CascadingParameter] public MainUserData ActorsModels { get; set; } = default!;

    public bool IsSuccessLoaded { get; set; } = false;

    private bool _parametersInitialized = false;
    private bool _dataLoaded = false;

    protected override async Task OnParametersSetAsync()
    {
        if (ActorsModels == null)
        {
            try
            {
                ActorsModels = await _currentUserService.RetrieveActorsModels();
            }
            catch (Exception ex)
            {
                return;
            }
        }

        if (!_parametersInitialized && ActorsModels != null)
        {
            _parametersInitialized = true;

            if (ActorsModels.BaseActorModelId != Guid.Empty)
            {
                BaseActor = ActorsModels.BaseActorDtoModel;
            }

            await InitializeDataAsync();
        }
    }

    private async Task InitializeDataAsync()
    {
        if (_dataLoaded)
            return;

        IsSuccessLoaded = false;

        try
        {
            _dataLoaded = true;
            IsSuccessLoaded = true;
        }
        catch (Exception ex)
        {
            Console.WriteLine("Ошибка загрузки данных: " + ex.Message);
        }
    }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    private string LicenseText;

    private void Ok()
    {
        MudDialog.Close(DialogResult.Ok(true));
    }

    private void Reset(MouseEventArgs args)
    {
        Settings = new ProjectSettings();
        StateHasChanged();
    }

    private async Task<IEnumerable<string>> SearchTimezones(string value, CancellationToken token)
    {
        var timezones = new[]
        {
        "UTC", "GMT", "EST", "PST", "MSK", "CET", "JST", "CST", "IST", "AEST"
    };

        if (string.IsNullOrEmpty(value))
            return timezones;

        return timezones.Where(x => x.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }
}